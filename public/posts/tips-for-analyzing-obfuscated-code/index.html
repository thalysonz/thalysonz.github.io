<!doctype html><html><head lang=en><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Tips for Analyzing Obfuscated Code - thalysonz</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Tips for Analyzing the PixPirate Malware Code"><meta property="og:image" content><meta property="og:url" content="http://localhost:1313/posts/tips-for-analyzing-obfuscated-code/"><meta property="og:site_name" content="thalysonz"><meta property="og:title" content="Tips for Analyzing Obfuscated Code"><meta property="og:description" content="Tips for Analyzing the PixPirate Malware Code"><meta property="og:locale" content="pt_BR"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-28T00:00:00+00:00"><meta property="article:modified_time" content="2023-12-28T00:00:00+00:00"><meta property="article:tag" content="Code"><meta property="article:tag" content="En"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tips for Analyzing Obfuscated Code"><meta name=twitter:description content="Tips for Analyzing the PixPirate Malware Code"><script src=http://localhost:1313/js/feather.min.js></script><link href=http://localhost:1313/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=http://localhost:1313/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css><link id=darkModeStyle rel=stylesheet type=text/css href=http://localhost:1313/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></head><body><div class=content><header><div class=main><a href=http://localhost:1313/>thalysonz</a></div><nav><a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/about>About</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>Tips for Analyzing Obfuscated Code</h1><div class=meta>Posted on Dec 28, 2023</div></div><section class=body><h2 id=introduction>Introduction</h2><p>I have completed my static analysis of the PixPirate malware code. A significant part of this period was dedicated to deobfuscating the JavaScript files used by the malware, which made considerable efforts to complicate analysis by third parties.</p><p>As can be seen in the images below, all files in &ldquo;project.zip&rdquo;, executed by the malware using AutoJS (a tool responsible for handling JS automation), are obfuscated. Therefore, I decided to take advantage of my current focus on this topic and provide some tips that might be helpful if you encounter any obfuscated JavaScript code in the future.</p><p><img src=https://cdn-images-1.medium.com/max/800/0*H1U5znQyzgslZECB.png alt=IMG1></p><p>Code obfuscation is the process of making it less readable to humans. It complicates the understanding of the code&rsquo;s functionalities, making it more difficult to copy or modify. This is achieved through the application of obfuscation techniques, which include renaming variables, modifying the code structure, inserting unnecessary or irrelevant code, and removing comments.</p><p>Our job here is to make the above code readable again, so we can understand how the malware operates. So, let&rsquo;s get started.</p><h3 id=1-formatting-the-code><strong>1. Formatting the Code</strong></h3><p>In the images above, the three files are essentially unreadable. However, formatting or restructuring the code would greatly aid our process, as it allows us to identify where a function starts or ends, separate functions, and thus, facilitate the next steps.</p><p>Below is an example of one of the files before and after formatting.</p><p><img src=https://cdn-images-1.medium.com/max/800/0*eSw5f1W4ejdxkLib.png alt=IMG2>
<img src=https://cdn-images-1.medium.com/max/800/0*VbPWBj-w8vcsHB95.png alt=IMG3></p><h3 id=2-renaming><strong>2. Renaming</strong></h3><p>The next step will be to change the names of functions, classes, variables, interfaces (or whatever we encounter) from something strange to something we can easily identify.</p><p>In the following example, we showcase some variables, constants, and functions, among other elements, with names in hexadecimal or random values, aimed at complicating the understanding of the code.</p><p><img src=https://cdn-images-1.medium.com/max/800/1*r3KG0kugsPm4OZyjCcQ3eA.png alt=IMG4></p><p>Here we have a function that essentially returns an array of strings. We&rsquo;ll start by renaming the function from a1_0x13b5 to mw_FunctionReturnStrings. In VS CODE, by right-clicking and selecting “Change All References”, we can modify all references to this function.</p><p><img src=https://cdn-images-1.medium.com/max/800/1*PPkedJg0CioISgRWsfWORA.png alt=IMG5></p><p>We can continue renaming the code according to its functionality, and we&rsquo;ll end up with something like the images below.</p><p><img src=https://cdn-images-1.medium.com/max/800/1*LW_Ol5LGvj5QS0bGZooZ2A.png alt=IMG6></p><p><img src=https://cdn-images-1.medium.com/max/800/0*qkTWmDifL23lvSuI.png alt=IMG6></p><p><img src=https://cdn-images-1.medium.com/max/800/1*vn9Abi_ECIKsHzwah_tBYA.png alt=IMG6></p><p><img src=https://cdn-images-1.medium.com/max/800/0*ozB6hWO2b4SMg_qK.png alt=IMG6></p><h3 id=3-understanding-the-code><strong>3. Understanding the Code</strong></h3><p>Now that we have a readable code, we just need to understand what all this code is doing. To do this, we can follow the function calls throughout the application. In the image below, I used <a href=https://playcode.io>playcode.io</a> to visualize the result of this array call, which is an important element of this code.</p><p><img src=https://cdn-images-1.medium.com/max/800/1*tehhaJXOk_vtyXF17CnHvg.png alt=IMG6></p><h3 id=4-application-flow><strong>4. Application Flow</strong></h3><p>This is a time-consuming process in which you will put together everything that&rsquo;s been written here and try to understand the flow as a whole, noting that one file may call another file and so on. In some cases, we will encounter code that is just junk, after all, we are dealing with obfuscation. But with the tips above, understanding the next obfuscated files you come across will be easier.</p><p>In the image below, I demonstrate the end of our JS code, where basically all this code was used to call the file &ldquo;permission/empower.js&rdquo;. Thus, I show that we moved from something unreadable to a much more readable code and managed to understand the flow that the application follows with this code. Now, we just need to do this with the rest of the code.</p><p><img src=https://cdn-images-1.medium.com/max/800/0*CsffVrvvv_vRJ9NB.png alt=IMG6></p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/code>code</a></li><li><a href=/tags/en>en</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/thalysonz rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://twitter.com/Thalysonsousx rel=me title=Twitter><i data-feather=twitter></i></a>
<a class=border></a></div><div class=footer-info>2024 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>