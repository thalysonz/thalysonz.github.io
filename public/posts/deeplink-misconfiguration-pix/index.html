<!doctype html><html><head lang=en><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>DeepLink Misconfiguration: Accessing PIX and Account Data - thalysonz</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Deeplink to pix steal"><meta property="og:image" content><meta property="og:url" content="http://localhost:1313/posts/deeplink-misconfiguration-pix/"><meta property="og:site_name" content="thalysonz"><meta property="og:title" content="DeepLink Misconfiguration: Accessing PIX and Account Data"><meta property="og:description" content="Deeplink to pix steal"><meta property="og:locale" content="pt_BR"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-26T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-26T00:00:00+00:00"><meta property="article:tag" content='("Mobile", "Bug-Bounty", "En")'><meta name=twitter:card content="summary"><meta name=twitter:title content="DeepLink Misconfiguration: Accessing PIX and Account Data"><meta name=twitter:description content="Deeplink to pix steal"><script src=http://localhost:1313/js/feather.min.js></script><link href=http://localhost:1313/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=http://localhost:1313/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css><link id=darkModeStyle rel=stylesheet type=text/css href=http://localhost:1313/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></head><body><div class=content><header><div class=main><a href=http://localhost:1313/>thalysonz</a></div><nav><a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/about>About</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>DeepLink Misconfiguration: Accessing PIX and Account Data</h1><div class=meta>Posted on May 26, 2024</div></div><section class=body><p>While analyzing an application, I noticed that some deeplink calls contained the &ldquo;path&rdquo; parameter, and this parameter was being used to define the path of the WebView that the application was accessing.</p><p><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wWBYh7-N0u06U4IYV_XyVQ.png alt=IMG></p><h3 id=controlling-the-path-with-deeplinks>Controlling the Path with Deeplinks</h3><p>So, we could control the path that the WebView was loading, but what if there was an &ldquo;@&rdquo; in the path parameter?</p><p>If we try to put an &ldquo;@&rdquo; in the path parameter, we can control the site that will be loaded in the application&rsquo;s WebView because instead of accessing <code>https://help-webview.com</code>, the WebView will load whatever comes after the &ldquo;@&rdquo;.</p><p><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zCwIgHCFhgCyZrNTB93WTw.png alt=IMG></p><p>When a browser encounters a URL with an “@” symbol, such as <a href=https://legit.com@evil.com>https://legit.com@evil.com</a>, it interprets the part before the “@” (in this case, legit.com) as the user credentials (username) for authentication. The actual URL that the browser will navigate to is the part after the “@” (in this case, evil.com).</p><p>Therefore, when you enter <a href=https://legit.com@evil.com>https://legit.com@evil.com</a> in the browser, it ignores legit.com and navigates to <a href=https://evil.com>https://evil.com</a>. This behavior can be exploited to create deceptive links that appear to lead to a trusted site but actually redirect to a different, potentially malicious site.</p><p>For example:</p><pre><code>•	URL entered: https://legit.com@evil.com
•	URL loaded: https://evil.com
</code></pre><h3 id=open-redirect-in-webview>Open Redirect in WebView</h3><p>Now, in summary, we would have an open redirect in the WebView. However, since it is a financial application, I would like to find a way to further impact this vulnerability. Analyzing the WebView that the application was supposed to load, I found in the libs that the page loads a WebView-bridge, which is essentially a bridge for communication/interaction between the page and the application.</p><h3 id=custom-bridge-implementation>Custom Bridge Implementation</h3><p>I think you can see where this is going, right?</p><p>If we redirect the application to our own server where we have implemented a custom bridge, we can control some calls that the application has implemented. I started rewriting the WebView-bridge library on a web page on my server. In the image below, I show some of the code.</p><p><img src=https://miro.medium.com/v2/resize:fit:618/format:webp/1*pAOWIGpdpNeQ5Eget6jAKA.png alt=IMG></p><p><img src=https://miro.medium.com/v2/resize:fit:1240/format:webp/1*feK2kZoKJio5EcbxtLl_aQ.png alt=IMG></p><p><img src=https://miro.medium.com/v2/resize:fit:718/format:webp/1*Z5-iW2sJQt4DjQOqCNkaAg.png alt=IMG></p><h3 id=javascript-bridge>JavaScript Bridge</h3><p>A JavaScript bridge acts as a communication channel for bidirectional data exchange between web content and the native application. iOS and Android WebViews support communication through JS bridges.</p><p><img src=https://terra-1-g.djicdn.com/71a7d383e71a4fb8887a310eb746b47f/cloudapi/V1.1/JSBridge%20%E4%BB%8B%E7%BB%8D%E5%9B%BEen.png alt=IMG></p><h3 id=exploration>Exploration</h3><p>Given this information, I created a POC (Proof of Concept) to exploit this vulnerability. Here are the steps:</p><ol><li><strong>Set up a server</strong>: I set up a server to host my custom WebView-bridge.</li><li><strong>Redirect the application</strong>: By modifying the deeplink path to include <code>@my-custom-server.com</code>, I redirected the WebView to load my server instead of the intended URL.</li><li><strong>Implement the custom bridge</strong>: On my server, I implemented a custom WebView-bridge that mimicked the original bridge but with added capabilities to intercept and control the communication between the web content and the application.</li><li><strong>Test the vulnerability</strong>: With the custom bridge in place, I tested various interactions to see what data I could access and what actions I could perform.</li></ol><h3 id=results>Results</h3><p>The custom bridge allowed me to intercept sensitive information and perform actions that should not have been possible, demonstrating a significant security vulnerability in the application.</p><ol><li><strong>user data</strong>: We can use the javascript bridge to get the user data, we can easily save this data by sending it to our server and storing it. As a visual example, I gave an Alert() on the data received from the javascript bridge</li></ol><p><img src=https://miro.medium.com/v2/resize:fit:530/format:webp/1*o0pZjce0sTO-OYlmLLS4AA.png alt=datauser></p><ol start=2><li><strong>PIX transfers</strong>: To make it even more critical, I decided to use the application’s API, which we could interact with to request a transfer in the background after loading the page. It required a second implementation in the bridge we had developed, but in the end, it was possible.</li></ol><p><img src=https://miro.medium.com/v2/resize:fit:778/format:webp/1*3lX02Y_UweJ-AjzR8dGqtQ.png alt=IMGBRIDGEPIX></p><p><img src=https://miro.medium.com/v2/resize:fit:788/format:webp/1*VYMt3s7VyAA3Kq52F5idgQ.png alt=IMGPIx></p><h3 id=conclusion>Conclusion</h3><p>This vulnerability highlights the importance of proper validation and security measures when handling deeplinks and WebViews in financial applications. Developers should ensure that all parameters are properly sanitized and that WebViews are configured to prevent such exploits.</p><p>For more information, you can check my profile: (@thalyson.sec)(<a href=https://medium.com/@thalyson.sec>https://medium.com/@thalyson.sec</a>)</p></section><div class=post-tags></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/thalysonz rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://twitter.com/Thalysonsousx rel=me title=Twitter><i data-feather=twitter></i></a>
<a class=border></a></div><div class=footer-info>2024 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>