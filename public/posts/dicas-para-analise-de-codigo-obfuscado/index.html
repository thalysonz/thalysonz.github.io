<!doctype html><html><head lang=en><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Dicas para análise de código ofuscado - thalysonz</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Analisando código do malware pixpirate"><meta property="og:image" content><meta property="og:url" content="http://localhost:1313/posts/dicas-para-analise-de-codigo-obfuscado/"><meta property="og:site_name" content="thalysonz"><meta property="og:title" content="Dicas para análise de código ofuscado"><meta property="og:description" content="Analisando código do malware pixpirate"><meta property="og:locale" content="pt_BR"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-27T00:00:00+00:00"><meta property="article:modified_time" content="2023-12-27T00:00:00+00:00"><meta property="article:tag" content="Code"><meta property="article:tag" content="Pt"><meta name=twitter:card content="summary"><meta name=twitter:title content="Dicas para análise de código ofuscado"><meta name=twitter:description content="Analisando código do malware pixpirate"><script src=http://localhost:1313/js/feather.min.js></script><link href=http://localhost:1313/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=http://localhost:1313/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css><link id=darkModeStyle rel=stylesheet type=text/css href=http://localhost:1313/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></head><body><div class=content><header><div class=main><a href=http://localhost:1313/>thalysonz</a></div><nav><a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/about>About</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>Dicas para análise de código ofuscado</h1><div class=meta>Posted on Dec 27, 2023</div></div><section class=body><h2 id=introdução>Introdução</h2><p>Finalizei minha análise estática no código do malware PixPirate. Uma parte significativa desse período foi dedicada a desofuscar os arquivos JavaScript utilizados pelo malware, que se empenhou bastante em dificultar a análise por parte de terceiros.</p><p>Como pode ser visto nas imagens abaixo, todos os arquivos presentes em <em>&ldquo;project.zip&rdquo;</em>, que é executado pelo malware usando o AutoJS (ferramenta responsável por cuidar da automação JS), estão ofuscados. Então, decidi aproveitar que estou focado nisso e trazer algumas dicas que podem ajudar caso vocês se deparem com algum código JavaScript obfuscado de agora em diante.</p><p><img src=https://cdn-images-1.medium.com/max/800/0*H1U5znQyzgslZECB.png alt=IMG1></p><p>A ofuscação de código é o processo de torná-lo menos legível para humanos. Ela complica a compreensão das funcionalidades do código, dificultando a sua cópia ou alteração. Isso é alcançado por meio da aplicação de técnicas de ofuscação, que englobam a renomeação de variáveis, modificação da estrutura do código, inserção de código desnecessário ou irrelevante e a remoção de comentários.</p><p>Nosso trabalho aqui é tornar esse código acima legível novamente, para que possamos entender como o <em>malware</em> atua. Então, vamos lá.</p><h3 id=1-formatando-o-código><strong>1. Formatando o código</strong></h3><p>Nas imagens acima, os três arquivos estão basicamente ilegíveis. Porém, formatar ou reestruturar o código já ajudaria muito nosso processo, pois assim conseguimos identificar onde função termina ou começa, separar funções, e assim, facilitar os próximos passos.</p><p>Abaixo, segue um exemplo de um dos arquivos antes e depois da formatação.</p><p><img src=https://cdn-images-1.medium.com/max/800/0*eSw5f1W4ejdxkLib.png alt=IMG2>
<img src=https://cdn-images-1.medium.com/max/800/0*VbPWBj-w8vcsHB95.png alt=IMG3></p><h3 id=2-alterando-os-nomes><strong>2. Alterando os nomes</strong></h3><p>O próximo passo será alterar os nomes das funções/classes/variáveis/interfaces(seja lá o que encontrarmos pela frente) de algo estranho para algo que possamos facilmente identificar.</p><p>No exemplo a seguir, apresentamos algumas variáveis, constantes e funções, entre outros elementos, com nomes em hexadecimal ou valores aleatórios, visando dificultar a compreensão do código.</p><p><img src=https://cdn-images-1.medium.com/max/800/1*r3KG0kugsPm4OZyjCcQ3eA.png alt=IMG4></p><p>Aqui temos uma função que basicamente retorna um array de strings, então vamos começar alterando o nome da função de a1_0x13b5 para mw_FunctionReturnStrings. No <strong>VS CODE</strong> apertando o botão direito do mouse e depois “Change all references”, alteramos todas as referências a essa função.</p><p><img src=https://cdn-images-1.medium.com/max/800/1*PPkedJg0CioISgRWsfWORA.png alt=IMG5></p><p>Podemos seguir renomeando o código de acordo com seu funcionamento e vamos ter algo como as imagens abaixo no final.</p><p><img src=https://cdn-images-1.medium.com/max/800/1*LW_Ol5LGvj5QS0bGZooZ2A.png alt=IMG6></p><p><img src=https://cdn-images-1.medium.com/max/800/0*qkTWmDifL23lvSuI.png alt=IMG6></p><p><img src=https://cdn-images-1.medium.com/max/800/1*vn9Abi_ECIKsHzwah_tBYA.png alt=IMG6></p><p><img src=https://cdn-images-1.medium.com/max/800/0*ozB6hWO2b4SMg_qK.png alt=IMG6></p><h3 id=3-entendendo-ocódigo><strong>3. Entendendo o código</strong></h3><p>Agora que temos um código legível só precisamos entender o que todo esse código está fazendo. Para isso, podemos seguir as chamadas de funções pela aplicação. Na imagem abaixo, utilizei o <a href=https://playcode.io>playcode.io</a> para visualizar o resultado da chamada desse array, que é um elemento importante desse código.</p><p><img src=https://cdn-images-1.medium.com/max/800/1*tehhaJXOk_vtyXF17CnHvg.png alt=IMG6></p><h3 id=4-fluxo-da-aplicação><strong>4. Fluxo da aplicação</strong></h3><p>Este é um processo demorado em que você vai juntar tudo o que foi escrito aqui e tentar entender o fluxo como um todo, percebendo que um arquivo pode chamar outro arquivo e assim por diante. Em alguns casos, vamos encontrar código que é apenas lixo, afinal estamos falando de ofuscação. Mas com as dicas acima, todo o entendimento dos próximos arquivos ofuscados que você pegar será mais fácil.</p><p>Na imagem abaixo demonstro o final do nosso código JS, onde basicamente todo este código foi usado para chamar o arquivo &ldquo;permission/empower.js&rdquo;. Assim, demonstro que saímos de algo ilegível para um código muito mais legível e conseguimos entender o fluxo que a aplicação faz com este código. Agora, só precisamos fazer isso com o restante do código.</p><p><img src=https://cdn-images-1.medium.com/max/800/0*CsffVrvvv_vRJ9NB.png alt=IMG6></p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/code>code</a></li><li><a href=/tags/pt>pt</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/thalysonz rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://twitter.com/Thalysonsousx rel=me title=Twitter><i data-feather=twitter></i></a>
<a class=border></a></div><div class=footer-info>2024 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>