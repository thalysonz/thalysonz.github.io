<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Web Cache Deception: Some Real Cases - thalysonz</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="real scenarios that I reported in 2023 in bug bounty programs"><meta property="og:image" content><meta property="og:title" content="Web Cache Deception: Some Real Cases"><meta property="og:description" content="real scenarios that I reported in 2023 in bug bounty programs"><meta property="og:type" content="article"><meta property="og:url" content="https://thalysonz.github.io/posts/web-cache-deception/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-29T00:00:00+00:00"><meta property="article:modified_time" content="2023-12-29T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Web Cache Deception: Some Real Cases"><meta name=twitter:description content="real scenarios that I reported in 2023 in bug bounty programs"><script src=https://thalysonz.github.iojs/feather.min.js></script><link href=https://thalysonz.github.io/css/fonts.11a1877508139eac0b5b4852ceb110c35641b3533321e66e39149e901ed5756b.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://thalysonz.github.io/css/main.d902908ac6e0fab67957de5db5aea1b6455b19ae2ca98eac4c95a4a0fdc02238.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://thalysonz.github.io/css/dark.c95c5dcf5f32f8b67bd36f7dab66680e068fce2b303087294114aabf7a7c080b.css><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></head><body><div class=content><header><div class=main><a href=https://thalysonz.github.io>thalysonz</a></div><nav><a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/about>About</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>Web Cache Deception: Some Real Cases</h1><div class=meta>Posted on Dec 29, 2023</div></div><section class=body><h2 id=web-cache-deception-wcd>Web Cache Deception (WCD)</h2><p>Web Cache Deception (WCD) is an attack in which an attacker tricks a cache proxy into improperly storing private information sent over the Internet, gaining unauthorized access to these cached data. It was proposed by Omer Gil, a security researcher, in 2017.</p><h2 id=introduction>Introduction</h2><p>Many are already aware of what Web Cache Deception is and how its exploitation works, so today I wanted to bring something different and show some real scenarios that I reported in 2023 in bug bounty programs.</p><h3 id=1-search-feature>1. Search Feature</h3><p>Our first case concerns a web application, most likely Laravel, where it was possible to exploit WCD by abusing the text search feature of the API. The PATH was something like <strong>/v2/search/{WORD}</strong> where {WORD} would be our search term. Changing the PATH to <strong>/v2/search/anything;.css</strong> led the server to respond to our request with the <strong>MISS</strong> Header, and subsequent requests with the <strong>HIT</strong> Header.</p><p>Below is an example of the response:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>HTTP</span><span class=o>/</span><span class=mi>2</span> <span class=mi>200</span> <span class=n>OK</span>
</span></span><span class=line><span class=cl><span class=n>Date</span><span class=p>:</span> <span class=n>Sun</span><span class=p>,</span> <span class=mi>10</span> <span class=n>Sep</span> <span class=mi>2023</span> <span class=mi>05</span><span class=p>:</span><span class=mi>55</span><span class=p>:</span><span class=mi>41</span> <span class=n>GMT</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Type</span><span class=p>:</span> <span class=n>application</span><span class=o>/</span><span class=n>json</span>
</span></span><span class=line><span class=cl><span class=n>Vary</span><span class=p>:</span> <span class=n>Accept</span><span class=o>-</span><span class=n>Encoding</span>
</span></span><span class=line><span class=cl><span class=n>Cache</span><span class=o>-</span><span class=ne>Control</span><span class=p>:</span> <span class=nb>max</span><span class=o>-</span><span class=n>age</span><span class=o>=</span><span class=mi>315360000</span>
</span></span><span class=line><span class=cl><span class=n>Set</span><span class=o>-</span><span class=n>Cookie</span><span class=p>:</span> <span class=n>XSRF</span><span class=o>-</span><span class=n>TOKEN</span><span class=o>=</span><span class=p>{</span><span class=n>COOKIE1</span><span class=p>};</span> <span class=n>expires</span><span class=o>=</span><span class=n>Tue</span><span class=p>,</span> <span class=mi>10</span><span class=o>-</span><span class=n>Oct</span><span class=o>-</span><span class=mi>2023</span> <span class=mi>05</span><span class=p>:</span><span class=mi>55</span><span class=p>:</span><span class=mi>39</span> <span class=n>GMT</span><span class=p>;</span> <span class=n>Max</span><span class=o>-</span><span class=n>Age</span><span class=o>=</span><span class=mi>2592000</span><span class=p>;</span> <span class=n>path</span><span class=o>=/</span><span class=p>;</span> <span class=n>secure</span>
</span></span><span class=line><span class=cl><span class=n>Set</span><span class=o>-</span><span class=n>Cookie</span><span class=p>:</span> <span class=n>toolzz_session</span><span class=o>=</span><span class=p>{</span><span class=n>COOKIE2</span><span class=p>};</span> <span class=n>expires</span><span class=o>=</span><span class=n>Tue</span><span class=p>,</span> <span class=mi>10</span><span class=o>-</span><span class=n>Oct</span><span class=o>-</span><span class=mi>2023</span> <span class=mi>05</span><span class=p>:</span><span class=mi>55</span><span class=p>:</span><span class=mi>39</span> <span class=n>GMT</span><span class=p>;</span> <span class=n>Max</span><span class=o>-</span><span class=n>Age</span><span class=o>=</span><span class=mi>2592000</span><span class=p>;</span> <span class=n>path</span><span class=o>=/</span><span class=p>;</span> <span class=n>secure</span><span class=p>;</span> <span class=n>httponly</span>
</span></span><span class=line><span class=cl><span class=n>Strict</span><span class=o>-</span><span class=n>Transport</span><span class=o>-</span><span class=n>Security</span><span class=p>:</span> <span class=nb>max</span><span class=o>-</span><span class=n>age</span><span class=o>=</span><span class=mi>15724800</span><span class=p>;</span> <span class=n>includeSubDomains</span>
</span></span><span class=line><span class=cl><span class=n>Server</span><span class=p>:</span> <span class=n>EDITED</span>
</span></span><span class=line><span class=cl><span class=n>Expires</span><span class=p>:</span> <span class=n>Thu</span><span class=p>,</span> <span class=mi>31</span> <span class=n>Dec</span> <span class=mi>2037</span> <span class=mi>23</span><span class=p>:</span><span class=mi>55</span><span class=p>:</span><span class=mi>55</span> <span class=n>GMT</span>
</span></span><span class=line><span class=cl><span class=n>Cdn</span><span class=o>-</span><span class=n>Location</span><span class=p>:</span> 
</span></span><span class=line><span class=cl><span class=n>EDITED</span><span class=o>-</span><span class=n>Cdn</span><span class=o>-</span><span class=n>Cachestatus</span><span class=p>:</span> <span class=n>HIT</span>
</span></span><span class=line><span class=cl><span class=n>X</span><span class=o>-</span><span class=n>Xss</span><span class=o>-</span><span class=n>Protection</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span> <span class=n>mode</span><span class=o>=</span><span class=n>block</span>
</span></span><span class=line><span class=cl><span class=n>Strict</span><span class=o>-</span><span class=n>Transport</span><span class=o>-</span><span class=n>Security</span><span class=p>:</span> <span class=nb>max</span><span class=o>-</span><span class=n>age</span><span class=o>=</span><span class=mi>31536000</span>
</span></span><span class=line><span class=cl><span class=n>X</span><span class=o>-</span><span class=n>Frame</span><span class=o>-</span><span class=n>Options</span><span class=p>:</span> <span class=n>SAMEORIGIN</span>
</span></span><span class=line><span class=cl><span class=n>X</span><span class=o>-</span><span class=n>Content</span><span class=o>-</span><span class=n>Type</span><span class=o>-</span><span class=n>Options</span><span class=p>:</span> <span class=n>nosniff</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Security</span><span class=o>-</span><span class=n>Policy</span><span class=p>:</span> <span class=n>upgrade</span><span class=o>-</span><span class=n>insecure</span><span class=o>-</span><span class=n>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[]</span>
</span></span></code></pre></div><p>In this scenario, we just had to send <strong><a href=https://edited.com/v2/search/VICTIM;.css>https://edited.com/v2/search/VICTIM;.css</a></strong> to a user, and their cookie would be saved in the page&rsquo;s response. We achieved a high impact with this vulnerability.</p><h3 id=2-ignoring-content>2. Ignoring Content</h3><p>This second case was quite similar to the first, but here the exploitation occurred because the application ignored everything that came after &ldquo;;&rdquo; in a specific version of the API. This application used the route /v4/me to obtain authenticated user data, but it still had older versions in production (such as v2 and v3) and in v2 specifically, everything after &ldquo;;&rdquo; was ignored. Therefore, we could exploit this application by sending <strong><a href=https://edited.com/v2/me;anything.css?params>https://edited.com/v2/me;anything.css?params</a></strong> to a user, and after clicking, their data, which were returned in the page response, would be stored in the cache.</p><p><img src=https://cdn-images-1.medium.com/max/800/1*y8g2zslj6uC0ENHN_uxNQg.png alt=IMG1></p><p><img src=https://cdn-images-1.medium.com/max/800/1*hyaCCBE9E_9LW4dxyGiEfA.png alt=IMG1></p><h3 id=3-abusing-other-functionalities-no-ato>3. Abusing Other Functionalities, no ATO</h3><p>In this scenario, I wanted to bring something different from account theft to show other horizons of exploitation. In this application, we also managed to make a part of the passed path be ignored by the application. While testing some scenarios, I noticed that the application returned a 404 and the path I tried to access, and when using some special characters in URL Encoding, it returned the output decoding. With this, when trying to access API paths passing <strong>%0a-anytext</strong> (\n in URL Encoding), it returned a 200 status code. So, it was just a matter of changing to <strong>/api/user%0a-anytext.css</strong> for us to have our response stored in cache.</p><p><img src=https://cdn-images-1.medium.com/max/800/1*PSZ4AMaLutHmgwAq7oNIVg.png alt=IMG1></p><p>However, unlike the previous applications, we couldn&rsquo;t exploit an Account Takeover (ATO) in a straightforward manner, as we were not dealing with cookies that were passed and returned in the same request simply. The application used Authorization Bearer, where the token is usually stored in local storage. Therefore, we couldn&rsquo;t just send an API link to a user and have their data saved in the cache, because it&rsquo;s the front-end of the application that constructs the requests for the API and adds the authorization header. As a result, our report was downgraded to a medium impact.</p><p><img src=https://cdn-images-1.medium.com/max/800/1*jKFfVY7fB-gM1oR5Wh2sMQ.png alt=IMG1></p><p>Focusing on high and critical impact reports, I moved on to another exploitation scenario where I attempted to use WCD to exploit features of the application. One such feature was the invitation to rooms where a user can create an invitation to their room/group and then destroy/deactivate it, making it no longer possible to enter through that invitation.</p><p>To exploit this feature, we first created an invitation and used WCD to save the content of this invitation in the cache <strong>/api/invite/INVITE%0a-randomtext.css</strong>. With its content now cached, we can destroy this invitation, but we still have the cached version, allowing us to access the group from a destroyed invitation.</p><p>Destroyed invitation, response not found.
<img src=https://cdn-images-1.medium.com/max/800/1*tnLvJqBa-kckni_w6obD8g.png alt=IMG1></p><p>Destroyed Invitation, Response Found
<img src=https://cdn-images-1.medium.com/max/800/1*GgTNEKqolWuJs_sO-6JDfw.png alt=IMG1></p><p>After sending it to the program&rsquo;s team, we got our result.</p><p><img src=https://cdn-images-1.medium.com/max/800/1*SYfefGNShBbYiwqcfiQVyQ.png alt=IMG1></p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/web>web</a></li><li><a href=/tags/wcd>WCD</a></li><li><a href=/tags/bug-bounty>bug-bounty</a></li><li><a href=/tags/en>en</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/thalysonz rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://twitter.com/Thalysonsousx rel=me title=Twitter><i data-feather=twitter></i></a>
<a class=border></a></div><div class=footer-info>2023 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>